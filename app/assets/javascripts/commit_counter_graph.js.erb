var commit_count = gon.commit_count;
var developer_name = gon.developer_name;
var color = d3.scale.category20();

var topPadding = 50;
var leftPadding = 100;
var rightPadding = 20;
var w = 500+leftPadding+rightPadding;
var h = 400;

var barHeight = 100;

var sum = function(arr) {
  var sum = 0;
  arr.forEach(function(elm) {
    sum += elm;
  });
  return sum;
};

var xScale = d3.scale.linear()
               .domain([0, sum(commit_count)])
               .range([0, 500])
               .nice();

var xAxis = d3.svg.axis()
                  .scale(xScale)
                  .orient("bottom");

var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

// x軸の表示
svg.append("g")
   .attr({
     class: "axis",
     transform: "translate("+leftPadding+", 150)"
   })
   .call(xAxis);

// 棒グラフの描画
svg.selectAll("rect")
   .data(commit_count)
   .enter()
   .append("rect")
   .attr("x", function(d,i) {
     var x = 0;
     for (var j=0; j<i; j++) {
       x += commit_count[j];
     }
     return leftPadding + xScale(x);
   })
   .attr("y", 40)
   .attr("width", function(d) {
     return xScale(d);
   })
   .attr("height", barHeight) 
   .attr("fill", function(d, i) {
     return color(i);
   });

// 開発者名の表示
svg.selectAll("developer_name")
   .data(developer_name)
   .enter()
   .append("text")
   .text(function(d) {
     return d;
   })
  .attr("x", function(d, i) {
    var x = 0;
    for (var j=0; j<i; j++) {
      x += commit_count[j];
    }
    return leftPadding + xScale(x) + xScale(commit_count[i])/2;
   })
   .attr("y", function(d) {
     return 25;
   })
   .attr("text-anchor", "middle")
   .attr("font-family", "sans-serif")
   .attr("font-size", "15px")
   .attr("fill", "black");

// コミット数の表示
svg.selectAll("commit_count")
   .data(commit_count)
   .enter()
   .append("text")
   .text(function(d) {
     return d;
   })
   .attr("x", function(d, i) {
     var x = 0;
     for (var j=0; j<i; j++) {
       x += commit_count[j];
     }
     return leftPadding + xScale(x) + xScale(d)/2;
   })
   .attr("y", function(d) {
     return 30 + barHeight/2;
   })
   .attr("text-anchor", "middle")
   .attr("font-family", "sans-serif")
   .attr("font-size", "20px")
   .attr("fill", "white");
